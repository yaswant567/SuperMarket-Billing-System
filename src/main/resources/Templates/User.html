<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.0/css/bootstrap.min.css}"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <title>Title</title>
</head>
<body>
<div class="admin">
  <div class="admin_input container my-2">
   <table class="table table-striped table-hover table-responsive-md table-dark">
    <thead>
    <tr>
      <th>ID</th>
      <th>ItemName</th>
      <th>Quantity</th>
      <th>Price(\Unit)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="entity : ${allItems}" th:onclick="|handleClick(${entity.id}, 'addToBill')|">
      <td th:text="${entity.id}"></td>
      <td th:text="${entity.name}"></td>
      <td th:text="${entity.qty}"></td>
      <td th:text="${entity.price}"></td>
    </tr>
    </tbody>
    </table>


  </div>
  <div class="admin_display">
    <table class="table table-striped table-hover table-responsive-md table-dark">
      <thead>
      <tr>
        <th>S.no</th>
        <th>ItemName</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="entity : ${view}">
        <td th:text="${entity.sno}"></td>
        <td th:text="${entity.name}"></td>
        <td th:text="${entity.qty}"></td>
        <td th:text="${entity.totalPrice}"></td>
      </tr>
      </tbody>
    </table>

  </div>
</div>
<script src="/webjars/bootstrap/5.1.0/js/bootstrap.min.js"></script>

<script>
  function handleClick(id, action) {
    var url = "/User/" + id;

    $.ajax({
        url: url,
        type: "GET",
        success: function (response) {
            if (action == "addToBill") {
            {
                alert(response);
                $.ajax({
                    url: "/User/addToUserTable",
                    type: "Post",
                    contentType: "application/json",
                    data: JSON.stringify(response),
                    success: function(data){
                      window.location.href = "/User";
                       alert("2");
<!--                      $.ajax({-->
<!--                        url: "/User/userItems",-->
<!--                        type: "GET",-->
<!--                        success: function(data){-->
<!--                          alert("3");-->

<!--                        }-->

<!--                        });-->
                    }
                    });
                }
            } else if (action == "delete") {
                // Make a DELETE request to delete the data from the database
                $.ajax({
                    url: url,
                    type: "DELETE",
                    success: function () {
                        // Reload the page to reflect the updated data
                        location.reload();
                    },
                    error: function () {
                        alert("Failed to delete data");
                    }
                });
            }
        },
        error: function () {
            alert("Failed to retrieve data");
        }
    });
}
</script>
</body>
</html>